#!/bin/sh

# Run this script immediately after cloning the codebase.

DEFAULT_PORT=3000

echo 'Setting up kale_records ...'

#
# npm installation
#
echo ''
echo 'Running npm install ...'
# Set up npm dependencies
npm install -g foreman nodemon gulp jshint jscs
npm install

DIR=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )
cd $DIR/..

# Set up configurable environment variables for Foreman
if [ ! -f .env ]; then
  echo "PORT=$DEFAULT_PORT" >> .env
fi


#
# Postgres setup
# Create the database
#
echo ''
echo 'Creating the Postgres database ...'
createuser -s kale_records
createdb kale_records_development -U kale_records

#
# Migrations
# Migrate the database
#
echo ''
echo 'Running migrations ...'

$DIR/migrate

echo ''
echo 'Done.'
echo ''
echo 'You can start your application by running:'
echo 'npm start'
